/*! For license information please see index.js.LICENSE.txt */
"use strict";exports.id="node_modules_pnpm_node-fetch_3_3_2_node_modules_node-fetch_src_utils_multipart-parser_js",exports.ids=["node_modules_pnpm_node-fetch_3_3_2_node_modules_node-fetch_src_utils_multipart-parser_js"],exports.modules={"../node_modules/.pnpm/node-fetch@3.3.2/node_modules/node-fetch/src/utils/multipart-parser.js":(e,t,n)=>{n.r(t),n.d(t,{toFormData:()=>h});var r=n("../node_modules/.pnpm/fetch-blob@3.2.0/node_modules/fetch-blob/from.js"),a=n("../node_modules/.pnpm/formdata-polyfill@4.0.10/node_modules/formdata-polyfill/esm.min.js");let o=0;const s={START_BOUNDARY:o++,HEADER_FIELD_START:o++,HEADER_FIELD:o++,HEADER_VALUE_START:o++,HEADER_VALUE:o++,HEADER_VALUE_ALMOST_DONE:o++,HEADERS_ALMOST_DONE:o++,PART_DATA_START:o++,PART_DATA:o++,END:o++};let i=1;const d=i,l=i*=2,E=e=>32|e,_=()=>{};class A{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=_,this.onHeaderField=_,this.onHeadersEnd=_,this.onHeaderValue=_,this.onPartBegin=_,this.onPartData=_,this.onPartEnd=_,this.boundaryChars={},e="\r\n--"+e;const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n),this.boundaryChars[t[n]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=s.START_BOUNDARY}write(e){let t=0;const n=e.length;let r=this.index,{lookbehind:a,boundary:o,boundaryChars:i,index:_,state:A,flags:h}=this;const c=this.boundary.length,f=c-1,D=e.length;let u,T;const R=e=>{this[e+"Mark"]=t},p=e=>{delete this[e+"Mark"]},m=(e,t,n,r)=>{void 0!==t&&t===n||this[e](r&&r.subarray(t,n))},b=(n,r)=>{const a=n+"Mark";a in this&&(r?(m(n,this[a],t,e),delete this[a]):(m(n,this[a],e.length,e),this[a]=0))};for(t=0;t<n;t++)switch(u=e[t],A){case s.START_BOUNDARY:if(_===o.length-2){if(45===u)h|=l;else if(13!==u)return;_++;break}if(_-1==o.length-2){if(h&l&&45===u)A=s.END,h=0;else{if(h&l||10!==u)return;_=0,m("onPartBegin"),A=s.HEADER_FIELD_START}break}u!==o[_+2]&&(_=-2),u===o[_+2]&&_++;break;case s.HEADER_FIELD_START:A=s.HEADER_FIELD,R("onHeaderField"),_=0;case s.HEADER_FIELD:if(13===u){p("onHeaderField"),A=s.HEADERS_ALMOST_DONE;break}if(_++,45===u)break;if(58===u){if(1===_)return;b("onHeaderField",!0),A=s.HEADER_VALUE_START;break}if(T=E(u),T<97||T>122)return;break;case s.HEADER_VALUE_START:if(32===u)break;R("onHeaderValue"),A=s.HEADER_VALUE;case s.HEADER_VALUE:13===u&&(b("onHeaderValue",!0),m("onHeaderEnd"),A=s.HEADER_VALUE_ALMOST_DONE);break;case s.HEADER_VALUE_ALMOST_DONE:if(10!==u)return;A=s.HEADER_FIELD_START;break;case s.HEADERS_ALMOST_DONE:if(10!==u)return;m("onHeadersEnd"),A=s.PART_DATA_START;break;case s.PART_DATA_START:A=s.PART_DATA,R("onPartData");case s.PART_DATA:if(r=_,0===_){for(t+=f;t<D&&!(e[t]in i);)t+=c;t-=f,u=e[t]}if(_<o.length)o[_]===u?(0===_&&b("onPartData",!0),_++):_=0;else if(_===o.length)_++,13===u?h|=d:45===u?h|=l:_=0;else if(_-1===o.length)if(h&d){if(_=0,10===u){h&=~d,m("onPartEnd"),m("onPartBegin"),A=s.HEADER_FIELD_START;break}}else h&l&&45===u?(m("onPartEnd"),A=s.END,h=0):_=0;if(_>0)a[_-1]=u;else if(r>0){const e=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);m("onPartData",0,r,e),r=0,R("onPartData"),t--}break;case s.END:break;default:throw new Error(`Unexpected state entered: ${A}`)}b("onHeaderField"),b("onHeaderValue"),b("onPartData"),this.index=_,this.state=A,this.flags=h}end(){if(this.state===s.HEADER_FIELD_START&&0===this.index||this.state===s.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==s.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}async function h(e,t){if(!/multipart/i.test(t))throw new TypeError("Failed to fetch");const n=t.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw new TypeError("no or bad content-type header, no multipart boundary");const o=new A(n[1]||n[2]);let s,i,d,l,E,_;const h=[],c=new a.FormData,f=e=>{d+=R.decode(e,{stream:!0})},D=e=>{h.push(e)},u=()=>{const e=new r.File(h,_,{type:E});c.append(l,e)},T=()=>{c.append(l,d)},R=new TextDecoder("utf-8");R.decode(),o.onPartBegin=function(){o.onPartData=f,o.onPartEnd=T,s="",i="",d="",l="",E="",_=null,h.length=0},o.onHeaderField=function(e){s+=R.decode(e,{stream:!0})},o.onHeaderValue=function(e){i+=R.decode(e,{stream:!0})},o.onHeaderEnd=function(){if(i+=R.decode(),s=s.toLowerCase(),"content-disposition"===s){const e=i.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);e&&(l=e[2]||e[3]||""),_=function(e){const t=e.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!t)return;const n=t[2]||t[3]||"";let r=n.slice(n.lastIndexOf("\\")+1);return r=r.replace(/%22/g,'"'),r=r.replace(/&#(\d{4});/g,((e,t)=>String.fromCharCode(t))),r}(i),_&&(o.onPartData=D,o.onPartEnd=u)}else"content-type"===s&&(E=i);i="",s=""};for await(const t of e)o.write(t);return o.end(),c}}};